<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Injection Test</title>
    <style>
        body { font-family: monospace; background-color: #1a202c; color: #cbd5e0; padding: 2rem; font-size: 1.1rem; line-height: 1.6; }
        h1, h2, h3 { color: #e2e8f0; }
        pre { background-color: #2d3748; padding: 1rem; border-radius: 8px; white-space: pre-wrap; word-break: break-all; border: 1px solid #4a5568; }
        .success { color: #68d391; font-weight: bold; font-size: 1.5rem; }
        .error { color: #fc8181; font-weight: bold; font-size: 1.5rem; }
    </style>
</head>
<body>
    <h1>Testing Netlify Snippet Injection</h1>
    <p>This page checks if the `__firebase_config` variable is being correctly injected by Netlify before the closing `</head>` tag.</p>
    <hr style="border-color: #4a5568; margin: 1.5rem 0;">
    <h2>Test Result:</h2>
    <div id="result"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resultDiv = document.getElementById('result');
            // Check for the window variable that the snippet should create
            if (typeof window.__firebase_config !== 'undefined' && window.__firebase_config) {
                try {
                    // Try to parse it to ensure it's valid
                    const config = JSON.parse(window.__firebase_config);
                    resultDiv.innerHTML = `
                        <p class="success">SUCCESS!</p>
                        <p>The <code>__firebase_config</code> variable was found and is valid JSON.</p>
                        <p>This means your Netlify Snippet Injection and Environment Variables are working correctly.</p>
                        <h3>Injected Configuration:</h3>
                        <pre>${JSON.stringify(config, null, 2)}</pre>
                    `;
                } catch (e) {
                     resultDiv.innerHTML = `
                        <p class="error">ERROR!</p>
                        <p>The <code>__firebase_config</code> variable was found, but it could not be parsed as JSON.</p>
                        <p>Please check the format of your snippet in the Netlify UI.</p>
                        <h3>Raw Variable Content:</h3>
                        <pre>${window.__firebase_config}</pre>
                    `;
                }
            } else {
                resultDiv.innerHTML = `
                    <p class="error">FAILURE!</p>
                    <p>The <code>__firebase_config</code> variable was NOT found on the window object.</p>
                    <p>This confirms that <strong>Netlify's Snippet Injection is not running or failing</strong> for this deployment. Please double-check your Snippet Injection settings in the Netlify UI.</p>
                `;
            }
        });
    </script>
</body>
</html>
